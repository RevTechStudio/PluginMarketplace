---
name: checking-inconsistencies
description: プロジェクト全体の不整合（矛盾と情報欠落）を検出し報告する。矛盾は記述内容の食い違い、情報欠落は上位ドキュメントの情報が下位ドキュメントにないこと。ドキュメント間、ドキュメントとコード間、規約との不整合、設定ファイル間をチェックし、シンプルに報告する。
---

# Checking Inconsistencies

プロジェクト全体の不整合（矛盾と情報欠落）を検出し、早期発見・早期解決を実現する。

## 用語定義

このスキルでは、以下の用語を明確に区別して使用する：

### 矛盾（Contradiction）
二つの事柄のつじつまが合わないこと。ドキュメントAとドキュメントBに記述してある内容が一致しない状態。

**例:**
- ドキュメントAに「ユーザー名は8文字以上」と記述
- ドキュメントBに「ユーザー名は6文字以上」と記述
- → これは矛盾

### 情報の欠落（Information Gap）
上位ドキュメントに記述してある情報が、下位ドキュメントに記述されていない状態。上位から下位への情報の伝達が不足している。

**例:**
- 要件定義書（上位）に「パスワードは英数字混在必須」と記述
- 詳細設計書（下位）にパスワード要件の記述がない
- → これは情報の欠落

**注意:** 下位ドキュメントに追加情報がある場合は、情報の追加であり、報告は不要。

### ドキュメントの階層
このプロジェクトでは、以下の階層でドキュメントが構成される（上位から下位へ）：

1. **プロジェクト解析ドキュメント**（最上位）
2. **アイディアドキュメント**
3. **要件定義書**
4. **詳細設計書**（最下位）

情報欠落のチェックは、上位から下位への情報伝達を確認する。例えば、アイディアドキュメント（上位）に記述された情報が要件定義書（下位）に記述されているかをチェックする。

## 目的

開発プロジェクトにおける不整合（矛盾と情報欠落）を体系的に検出し報告することで、手戻りや問題の発生を防ぐ。development-conventionsの「矛盾を無視しない」ルールを実践し、ドキュメント、コード、規約、設定ファイル間の不整合を早期に発見する。

## 責任範囲

### 矛盾の検出
- ドキュメント間の矛盾を検出する
  - 複数ドキュメント間で記述内容が食い違っている箇所を発見する
  - 同じ概念や機能について、異なる仕様が記述されている箇所を特定する
- ドキュメントとコード間の矛盾を検出する
  - ドキュメントの記述と実際のコード実装が食い違っている箇所を発見する
  - 仕様書に記載された機能とコードの実装が異なる箇所を特定する
- 規約との矛盾を検出する
  - development-conventions等の規約とコード/ドキュメントが食い違っている箇所を発見する
  - コーディング規約、命名規則、プロジェクト固有ルールへの違反を特定する
- 設定ファイル間の矛盾を検出する
  - package.json、tsconfig.json、.envファイル等の設定が食い違っている箇所を発見する
  - 依存関係やバージョン、環境変数の矛盾を特定する

### 情報の欠落の検出
- ドキュメント間の情報欠落を検出する
  - 上位ドキュメントに記述されている情報が、下位ドキュメントに記述されていない箇所を発見する
  - プロジェクト解析ドキュメント、アイディアドキュメント、要件定義書の内容が、詳細設計書に適切に反映されているか確認する
  - 各階層間での情報伝達の漏れを特定する

### 報告
- 矛盾と情報欠落を明確に区別してシンプルに報告する
  - 矛盾と情報欠落を別々のセクションで報告する
  - 各不整合について、箇所と内容を具体的に示す

**責任範囲外:**
- 不整合の自動修正
  - 修正はユーザーの意思決定が必要であり、このスキルは報告のみを行う
- 不整合の優先順位付けや影響度判断
  - ビジネス判断や影響範囲の評価はユーザーが行う
- 解決策の実装提案
  - 不整合を報告するのみで、具体的な実装方法の提案や修正作業は行わない

## ワークフロー

### 不整合チェック実行

このチェックリストをコピーして進捗を追跡します：

```
不整合チェック進捗：
- [ ] ステップ1：チェック範囲を特定する
- [ ] ステップ2：ドキュメント間の矛盾をチェックする
- [ ] ステップ3：ドキュメント間の情報欠落をチェックする
- [ ] ステップ4：ドキュメントとコード間の矛盾をチェックする
- [ ] ステップ5：規約との矛盾をチェックする
- [ ] ステップ6：設定ファイル間の矛盾をチェックする
- [ ] ステップ7：不整合リストを報告する
```

**ステップ1：チェック範囲を特定する**

プロジェクト全体を把握し、チェック対象を特定する：
- プロジェクトのディレクトリ構造を確認する
- 存在するドキュメントファイル（.md、.txt等）をリストアップする
- コードファイルの種類と配置を確認する
- 設定ファイル（package.json、tsconfig.json、.env等）を特定する
- 規約ファイル（conventions.md、coding-standards.md等）を確認する

ユーザーから特定のファイルやディレクトリの指定がある場合は、その範囲に絞る。

**ステップ2：ドキュメント間の矛盾をチェックする**

複数のドキュメント間で記述内容が食い違っている箇所を検出する：
- 同じ概念や機能について異なる仕様が記述されていないか確認する
- 用語の定義が食い違っていないか確認する
- バージョン情報や日付が食い違っていないか確認する
- 相反する要件や仕様が記載されていないか確認する

以下のような矛盾を特定する：
- ドキュメントAに「8文字以上」、ドキュメントBに「6文字以上」と異なる仕様が記述されている
- README.mdとドキュメントで同じ概念に異なる用語が使われている（例: 「ユーザーID」と「利用者番号」）
- 複数のドキュメントで矛盾する手順が説明されている

**ステップ3：ドキュメント間の情報欠落をチェックする**

上位ドキュメントに記述されている情報が、下位ドキュメントに記述されていない箇所を検出する：
- 各階層のドキュメント（プロジェクト解析、アイディア、要件定義、詳細設計）の重要な情報を特定する
- 上位から下位への情報伝達が適切に行われているか、階層ごとに確認する
  - プロジェクト解析ドキュメント → アイディアドキュメント
  - アイディアドキュメント → 要件定義書
  - 要件定義書 → 詳細設計書

以下のような情報欠落を特定する：
- 要件定義書に「パスワードは英数字混在必須」と記述されているが、詳細設計書にパスワード要件の記述がない
- アイディアドキュメントに「エラー時は3回までリトライ」と記述されているが、要件定義書にリトライ処理の記述がない

**注意:** 下位ドキュメントに追加情報がある場合（上位にない情報が下位にある）は、情報の追加であり報告不要。

**ステップ4：ドキュメントとコード間の矛盾をチェックする**

ドキュメントの記述と実際のコード実装の乖離を検出する：
- ドキュメントに記載された機能がコードに実装されているか確認する
- 関数名、クラス名、変数名がドキュメントと一致しているか確認する
- APIエンドポイント、パラメータ、レスポンス形式が一致しているか確認する
- ドキュメントで廃止とされた機能がコードに残っていないか確認する

以下のような矛盾を特定する：
- ドキュメントに記載された関数がコードに存在しない
- APIドキュメントと実装で異なるパラメータが使われている
- 設計書の記述とコードの実装ロジックが異なる

**ステップ5：規約との矛盾をチェックする**

プロジェクトの規約とコード/ドキュメントの不整合を検出する：
- development-conventions等の規約ファイルを読み込む
- コーディング規約への違反を確認する
- 命名規則の違反を確認する
- プロジェクト固有ルールへの違反を確認する
- ドキュメント規約への違反を確認する

以下のような矛盾を特定する：
- 規約で禁止されているAPIや技術が使用されている
- 命名規則に従っていない変数名やファイル名がある
- 規約で定められた形式と異なるドキュメント構造になっている

**ステップ6：設定ファイル間の矛盾をチェックする**

複数の設定ファイル間の不整合を検出する：
- package.jsonの依存関係とlock fileの整合性を確認する
- 環境変数の定義と使用箇所の一致を確認する
- 複数の設定ファイルで同じ項目の値が一致しているか確認する
- バージョン情報の整合性を確認する

以下のような矛盾を特定する：
- package.jsonとpackage-lock.jsonのバージョンが不一致
- .envファイルで定義されていない環境変数がコードで使用されている
- tsconfig.jsonとpackage.jsonで異なるTypeScriptバージョンが指定されている

**ステップ7：不整合リストを報告する**

検出した矛盾と情報欠落をシンプルなリスト形式で報告する。

不整合が検出されなかった場合は、その旨を報告する。

## 出力

### 不整合チェック結果

```markdown
## 不整合チェック結果

### 矛盾
- ファイルA と ファイルB: 説明
- ファイルC: 規約違反の内容

### 情報の欠落
- 上位ドキュメント → 下位ドキュメント: 欠落している情報

矛盾: X件、情報欠落: Y件
```

不整合が検出されなかった場合の出力：

```markdown
## 不整合チェック結果

不整合は検出されませんでした。
```

## 注意事項

- **ユーザーの明示的な指示**: このスキルはユーザーが不整合チェックを明示的に指示したときのみ使用する
- **報告のみ**: 不整合を発見しても、自動的に修正せず、ユーザーに報告する
- **範囲の確認**: チェック範囲が広い場合は、ユーザーに確認してから実行する
- **false positive**: 意図的な違いを不整合として誤検出する可能性があるため、報告内容はユーザーが最終判断する
- **矛盾と情報欠落の区別**: 矛盾（記述内容の食い違い）と情報欠落（上位から下位への情報伝達の不足）を明確に区別して報告する
- **development-conventionsとの連携**: 不整合を発見したら、development-conventionsの「質問フォーマット」に従ってユーザーに確認することが推奨される
