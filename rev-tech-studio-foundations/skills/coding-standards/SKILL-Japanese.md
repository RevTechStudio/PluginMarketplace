---
name: コーディング規約
description: C# のコーディング規約とベストプラクティス。C#コードの記述、レビュー、コード品質と規約に関する議論の際に適用する。
---

# コーディング規約

## 命名規則

### **最重要: アンダースコア接頭辞の禁止**

**すべての命名においてアンダースコア接頭辞 (`_`) は厳禁とする。**  
このルールは命名規則の中で最重要であり、例外なく徹底すること。

### 一般的な命名ルール

- 名称は役割と目的が明確にわかるものにする
- 一般的でない略語は使用しない
- Boolean型は `is`, `has`, `can`, `should` を先頭に付ける
- 定数は UPPER_SNAKE_CASE
- クラス・メソッド・プロパティ・定数は PascalCase
- ローカル変数・パラメータ・プライベートフィールドは camelCase
- インターフェースは `I` + PascalCase

## コード設計

- 関数は単一責任とする
- 1つの関数は100行以内を目安とする
- ネストは最大3段階まで
- ガード節を使用し、早期リターンを徹底する
- マジックナンバーを避け、定数を使用する
- **中括弧 `{}` は省略しない**（1行のステートメントでも必ず使用）
- **短い処理は1行で書く**（短い条件・処理は中括弧つきで1行にまとめる）

## コメントとドキュメンテーション

- 「何を」ではなく「なぜ」を記述する
- **TODO/FIXME コメントは禁止** → Issue に登録する
- コメントアウトされたコードは削除する
- すべてのクラス・メソッド（非公開も含む）にドキュメンテーションコメントを付ける

## 例外処理とログ

- 例外は例外的状況のみに使用する
- 例外を握りつぶさない
- 標準例外で不十分な場合はカスタム例外を作成する
- 例外クラス名は `Exception` で終わらせる
- エラー時には十分な情報をログ出力する

### ログレベル

- **Debug**: 詳細な開発用情報
- **Info**: 起動、終了、重要な操作
- **Warning**: 注意すべき状況だが処理可能
- **Error**: 復旧可能なエラー
- **Critical**: システム停止を伴う重大なエラー

## パフォーマンス

- 早すぎる最適化を避ける
- `using` によりリソース破棄を徹底する
- I/O 操作は非同期で実施する

## セキュリティ

- パスワードや API キーをソースに埋め込まない
- 外部入力は常にバリデーション・サニタイズを行う
- 依存関係を定期的に更新し、脆弱性を確認する

## C# スタイル

- Nullable Reference Types を有効化する
- 型が明確な場合は `var` を使用する
- 単純な処理には式形式メンバー（`=>`）を使用する
- 文字列補間 `$"..."` を使用する
- コレクション処理は LINQ を活用する
- リソース管理には using ステートメントまたは宣言を使用
- 不変データには record 型を使用する
- `async void` はイベントハンドラ以外では使用しない
- 非同期メソッドは `Task` または `ValueTask` を返す

## パフォーマンス最適化

- 頻繁なメモリ操作には `Span<T>` や `Memory<T>` を検討する
- 同期的に終わることが多い非同期処理には `ValueTask` を検討する
- ループ内の文字列連結には `StringBuilder` を使用する

## 属性とアノテーション

- 廃止予定コードには `[Obsolete]` を付与し、代替を提示する
- 必要に応じて適切な属性を使用する

## 最新機能活用

積極的に使用する C# のモダン機能：

- Record 型
- init アクセサ
- トップレベルステートメント
- 拡張されたパターンマッチング
- file スコープ型
- Raw 文字列リテラル
- required 修飾子
- プライマリコンストラクタ
- コレクション式
- 型エイリアス
- params コレクション
- Global using（プロジェクト合意の上）
- File-scoped namespace（プロジェクト合意の上）
