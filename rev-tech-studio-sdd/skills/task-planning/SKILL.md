---
name: task-planning
description: 詳細設計書を実装可能なタスク計画に落とし込むスキル。実装の優先順位、順序、依存関係を明確にし、効率的な開発を実現する。タスク計画、実装計画、開発計画、スプリント計画について言及している場合に使用してください。
---

# Task Planning

## 目的

詳細設計書を、開発チームが効率的に実装できるタスク計画に落とし込む。

## 責任範囲

- 詳細設計書を読み込み、実装すべき内容を把握する
  - 実装の全体像を理解し、漏れなく計画を立てる
- 開発環境と依存関係を確認する
  - 実装に必要なツールと環境を明確にし、スムーズな開発を可能にする
- 実装の優先順位と順序を決定する
  - 要件の優先度と依存関係を考慮し、効率的な実装順序を決定する
- タスクを実装単位に分割する
  - 実装可能な粒度にタスクを分割し、進捗管理を容易にする
- 依存関係を明確にする
  - タスク間の依存関係を整理し、並行開発を可能にする
- タスク計画書を作成する
  - 実装フェーズで参照できる形でタスク計画を記録する

**責任範囲外:**

- 実際のコード実装
  - implementationスキルで行う内容である
- テストコードの作成
  - implementationスキルで行う内容である
- 品質チェックの実施
  - implementationスキルで行う内容である
- 要件の変更や追加
  - requirements-definitionフェーズに戻る必要がある
- 詳細設計の変更
  - detailed-designフェーズに戻る必要がある

## ワークフロー

### 1. 詳細設計書の確認

詳細設計書を読み込み、実装すべき内容を把握する。
- 実装の全体像を理解し、漏れなく計画を立てる

**読み込みの手順:**

1. 入力ファイルパスが指定されている場合は、そのファイルを読み込む
2. 入力ファイルパスが指定されていない場合は、ユーザーに確認する

**確認する項目:**

- 技術スタック
- システムアーキテクチャ
- コンポーネント設計
- データベース設計（ある場合）
- API設計（ある場合）
- セキュリティ設計（ある場合）
- ディレクトリ構造
- 要件の優先順位（P1〜P4）

**重要:** 不明点や矛盾があれば即座にユーザーに確認する。曖昧なまま進めない。

### 2. 開発環境の確認

プロジェクトの開発環境を確認し、実装の準備を整える。
- 実装に必要なツールと依存関係を確認し、スムーズな開発を可能にする

**確認する項目:**

#### プロジェクト構造

- 既存のプロジェクトファイルとディレクトリ構成
- プロジェクトのルートディレクトリ
- ソースコードのディレクトリ構成

#### 依存関係

- パッケージマネージャーのファイル（package.json、requirements.txt、*.csproj等）
- 必要なライブラリ・パッケージのリスト
- インストール済みの依存関係

#### 開発ツール

- linter、formatterの設定
- テストフレームワークの設定
- ビルドツールの設定

#### ビルド環境

- ビルドが成功するか確認
- 開発サーバーが起動するか確認（Webアプリの場合）

**確認方法:**

1. プロジェクトルートを確認する
2. パッケージマネージャーのファイルを読み込む
3. 必要に応じて依存関係のインストール状況を確認する
4. ビルドコマンドを実行して動作を確認する

**注意:** ユーザーに環境の準備状況を確認してから次のステップへ進む。

### 3. 実装範囲の特定

要件定義書の優先順位に基づき、実装範囲を決定する。
- 限られたリソースで最大の価値を提供するため、実装範囲を明確にする

**特定する項目:**

#### 優先順位別の機能リスト

- **P1（最優先）**: プロジェクトの核となる機能
- **P2（高優先）**: 初期リリースに必要な機能
- **P3（中優先）**: リリース後の追加も可能な機能
- **P4（低優先）**: 将来的に検討する機能

#### 実装フェーズの決定

どの優先順位までを今回のタスク計画に含めるか決定：
- 最小限のMVP（P1のみ）
- 初期リリース版（P1 + P2）
- 完全版（P1 + P2 + P3）

**質問フォーマットに従い、ユーザーに確認する:**

```markdown
今回のタスク計画に含める実装範囲を教えてください。

A. **最小限のMVP**: P1機能のみ（[X個の機能]）
B. **初期リリース版**: P1 + P2機能（[Y個の機能]）
C. **完全版**: P1 + P2 + P3機能（[Z個の機能]）
D. **カスタム**: 特定の機能を選択

**推奨**: **B. 初期リリース版** - コア機能と重要機能をバランス良く実装できます
```

**注意:** ユーザーの回答を待ってから次のステップへ進む。

### 4. タスクの分割

実装範囲をタスク単位に分割する。
- 実装可能な粒度にタスクを分割し、進捗管理を容易にする

**分割の原則:**

#### 粒度の基準

- **1タスク = 0.5〜2日の作業量**を目安にする
- 大きすぎるタスクは分割する
- 小さすぎるタスクは統合する

#### レイヤー別の分割

コンポーネント設計に基づき、レイヤー別にタスクを分割：

1. **データモデル/エンティティ層**
   - エンティティクラスの定義
   - バリデーションの実装
   - データアクセスのインターフェース定義

2. **データアクセス層（リポジトリ）**
   - リポジトリインターフェースの定義
   - リポジトリ実装
   - データベースマイグレーション（必要な場合）

3. **ビジネスロジック層（サービス）**
   - サービスインターフェースの定義
   - ビジネスロジックの実装
   - ドメインロジックの実装

4. **プレゼンテーション層（コントローラー/UI）**
   - コントローラーの実装（バックエンド）
   - UIコンポーネントの実装（フロントエンド）
   - API統合

5. **テスト**
   - ユニットテストの実装
   - 統合テストの実装

6. **ドキュメント・品質**
   - ドキュメント更新
   - コードレビュー
   - 品質チェック

**タスク定義のフォーマット:**

各タスクについて以下を定義：
- タスクID: T001、T002...
- タスク名: 明確で具体的な名前
- 説明: 何を実装するか
- 成果物: 実装するファイル・コンポーネント
- 見積もり: 作業時間（時間または日）
- 担当者: （チーム開発の場合）

### 5. 依存関係の整理

タスク間の依存関係を明確にする。
- 並行開発を可能にし、効率的な実装順序を決定する

**依存関係の種類:**

#### 技術的依存関係

- **前提条件**: タスクAが完了しないとタスクBを開始できない
  - 例: エンティティ定義 → リポジトリ実装
- **推奨順序**: 技術的には並行可能だが、順序があった方が効率的
  - 例: インターフェース定義 → 実装

#### ビジネスロジック依存関係

- **機能依存**: 機能Aが実装されないと機能Bをテストできない
  - 例: ユーザー登録 → ログイン機能

**依存関係の表現:**

- 依存関係図を作成する（Mermaid形式）
- 各タスクの「前提タスク」を明記する

**並行開発の特定:**

- 依存関係のないタスクを特定する
- 並行開発可能なタスクをグループ化する

### 6. 実装順序の決定

優先順位と依存関係に基づき、実装順序を決定する。
- 効率的な実装を実現し、早期に価値を提供する

**決定の原則:**

#### 優先順位優先

- P1機能を最優先で実装する
- 同じ優先度内では、依存関係を考慮する

#### ボトムアップアプローチ

- 依存される側から実装する
  - データモデル → リポジトリ → サービス → コントローラー

#### リスク優先

- 技術的に不確実な部分を早期に実装し、リスクを低減する
- 外部依存が多い部分を早期に実装し、統合問題を早期発見する

#### 価値提供優先

- ユーザーに価値を提供できる機能を優先する
- E2Eで動作確認できる単位で実装する

**実装フェーズの定義:**

タスクをフェーズに分割：
- **フェーズ1**: 基盤実装（P1機能の基本部分）
- **フェーズ2**: コア機能実装（P1機能の完成）
- **フェーズ3**: 重要機能実装（P2機能）
- **フェーズ4**: 追加機能実装（P3機能）

### 7. 見積もりの作成

各タスクの作業時間を見積もる。
- リソース計画とスケジュール管理を可能にする

**見積もりの方法:**

#### プランニングポーカー（チーム開発の場合）

- チームメンバーで見積もりを議論する
- 合意した見積もりを採用する

#### 類似タスクとの比較

- 過去の類似タスクの実績を参考にする
- 経験則に基づいて見積もる

#### 楽観値・悲観値・最頻値

- 楽観的な見積もり（最短）
- 悲観的な見積もり（最長）
- 最も可能性の高い見積もり
- 期待値 = (楽観値 + 4×最頻値 + 悲観値) / 6

**見積もりの単位:**

- 小規模タスク: 時間単位（2時間、4時間、8時間）
- 中規模タスク: 日単位（0.5日、1日、2日）
- 大規模タスク: 週単位（1週間、2週間）
  - ※大規模タスクは分割を検討する

**バッファの確保:**

- 見積もりに不確実性のバッファを含める
- プロジェクト全体で10-20%のバッファを確保する

### 8. タスク計画書の作成

収集した情報をタスク計画書としてドキュメント化する。
- 実装フェーズで参照できる形でタスク計画を記録する

**ドキュメント構成:**

1. **プロジェクト概要** - プロジェクト名、目的、実装範囲
2. **実装環境** - 技術スタック、開発環境、依存関係
3. **実装フェーズ** - フェーズ別の実装計画
4. **タスク一覧** - 全タスクの詳細（ID、名前、説明、見積もり、依存関係）
5. **依存関係図** - タスク間の依存関係をMermaid図で表現
6. **スケジュール** - フェーズ別のスケジュール、マイルストーン
7. **リスクと対策** - 想定されるリスクと対応策

**ドキュメント形式:**

- Markdown形式で作成する
- [タスク計画テンプレート](./templates/task-plan-template.md)を使用する
- 保存先はユーザーに確認する

**ドキュメント例については[EXAMPLE.md](EXAMPLE.md)を参照してください。**

## 出力

実装フェーズで参照できるタスク計画書。以下の項目を含む：

1. **プロジェクト概要**: プロジェクト名、目的、実装範囲
2. **実装環境**: 技術スタック、開発環境、依存関係
3. **実装フェーズ**: フェーズ別の実装計画と目標
4. **タスク一覧**: 全タスクの詳細（ID、名前、説明、見積もり、依存関係、担当者）
5. **依存関係図**: タスク間の依存関係を視覚化したMermaid図
6. **スケジュール**: フェーズ別のスケジュール、マイルストーン、完了予定日
7. **リスクと対策**: 想定されるリスクと対応策

**重要:** タスク計画書は実装可能なレベルまで具体化し、曖昧さを排除すること。

## 注意事項

- **ユーザーとの対話**: 実装範囲が不明確な場合は、推測せずにユーザーに質問する
- **段階的な進行**: 各ステップの完了後、次のステップに進む前にユーザーに確認する（必要に応じて）
- **設計の尊重**: 詳細設計の意図を理解し、設計に忠実に計画を立てる。設計変更が必要な場合はユーザーに確認する
- **現実的な見積もり**: 過度に楽観的な見積もりを避け、バッファを確保する
- **柔軟性の確保**: 計画は変更される前提で、調整可能な余地を残す
- **EXAMPLE参照**: [EXAMPLE.md](EXAMPLE.md)
