---
name: detailed-design
description: 要件定義書を実装可能な詳細設計書に落とし込むスキル。技術スタック、アーキテクチャ、データベース設計、API設計を提供し、開発チームが実装を開始できるレベルの設計を作成する。詳細設計、技術選定、アーキテクチャ、データベース設計、API設計について言及している場合に使用してください。
---

# Detailed Design

## 目的

要件定義書を、開発チームが実装を開始できるレベルの詳細設計書に落とし込む。

## 責任範囲

- 技術スタック・フレームワークを選定する
  - 要件に基づき最適な技術を提案し、実装の基盤を確立する
- システムアーキテクチャを設計する
  - システム全体の構成とコンポーネント間の関係を定義し、拡張性と保守性を確保する
- データベースを設計する
  - テーブル定義、ER図、インデックス、制約を作成し、データの整合性を保証する
- API仕様を設計する
  - エンドポイント、リクエスト/レスポンス形式を定義し、フロントエンド・バックエンド間の連携を明確にする
- コンポーネント・モジュールを設計する
  - 実装単位となるコンポーネントの責務と依存関係を明確にし、テスタビリティを向上させる
- セキュリティ設計を具体化する
  - 非機能要件に基づき、認証・認可の実装方法を定義し、データ保護を実現する
- ディレクトリ構造を提案する
  - プロジェクトの基本構造を定義し、開発効率を高める
- 開発規約を適用する
  - development-conventionsとcoding-conventionsに従った設計を行い、一貫性を保つ

**責任範囲外:**

- 実装（コードの記述）
  - 開発フェーズで行う内容である
- テストコードの記述
  - 実装と並行して作成する内容である
- デプロイメント設定の詳細
  - インフラ構築フェーズで行う内容である
- 要件の変更や追加
  - 要件定義フェーズに戻る必要がある
- 詳細なパフォーマンスチューニング
  - 実装後のパフォーマンス測定に基づいて行う

## ワークフロー

### 1. 要件定義書の確認

要件定義書を読み込み、全体像を把握する。
- 設計の基盤となる情報を正確に理解する

**読み込みの手順:**

1. 入力ファイルパスが指定されている場合は、そのファイルを読み込む
2. 入力ファイルパスが指定されていない場合は、ユーザーに確認する

**確認する項目:**

- 機能要件と優先順位
- 非機能要件（パフォーマンス、セキュリティ、可用性、保守性、互換性）
- 制約事項
- 想定されるリスク

**重要:** 不明点や矛盾があれば即座にユーザーに確認する。曖昧なまま進めない。

### 2. 技術スタックの選定

要件に基づき、技術スタック候補を提案する。
- 実装の基盤となる技術を決定し、後工程での技術的負債を防ぐ

**選定基準:**

- 最新の安定版を使用する（development-conventions準拠）
- 依存関係は最小限にする
- 非機能要件を満たす
- チームの技術スタックとの整合性

**選定する項目:**

- フロントエンドフレームワーク
- バックエンドフレームワーク・言語
- データベース
- 認証・認可ライブラリ
- その他の主要ライブラリ

**質問フォーマットに従い、ユーザーに確認する:**

```markdown
**[選定項目名]について**

A. **[選択肢A]**: [説明]
B. **[選択肢B]**: [説明]
C. **[選択肢C]**: [説明]
D. **その他**

**推奨**: **[推奨する選択肢]** - [理由]
```

**注意:** ユーザーの承認を待ってから次のステップへ進む。

### 3. システムアーキテクチャの設計

システム全体の構成を設計する。
- システムの骨格を定義し、拡張性と保守性を確保する

**設計する項目:**

- レイヤー構成（プレゼンテーション層、ビジネスロジック層、データアクセス層など）
- コンポーネント構成と責務
- コンポーネント間の通信方法
- 状態管理の方法
- 非機能要件への対応方針

**設計の原則:**

- 単一責任の原則を適用する
- 疎結合・高凝集を目指す
- 依存関係を明確にする
- テスタビリティを考慮する

**注意:** ユーザーに提案し、承認を得てから次のステップへ進む。

### 4. データベース設計

データ構造を具体化する。
- データの整合性を保証し、パフォーマンスを最適化する

**設計する項目:**

#### テーブル定義

各テーブルについて以下を定義：
- テーブル名
- カラム名、データ型、Null許可、デフォルト値
- 主キー、外部キー
- インデックス
- ユニーク制約

#### ER図

- テーブル間のリレーションシップを視覚化する
- カーディナリティを明示する

#### 命名規則

- テーブル名、カラム名の命名規則を統一する
- 一貫性を保つ

### 5. API設計

フロントエンド・バックエンド間の連携を定義する。
- インターフェースを明確にし、並行開発を可能にする

**設計する項目:**

#### エンドポイント定義

各エンドポイントについて以下を定義：
- HTTPメソッド（GET, POST, PUT, DELETE）
- パス
- 説明

#### リクエスト形式

- パスパラメータ
- クエリパラメータ
- リクエストボディ（JSON形式）

#### レスポンス形式

- 成功時のレスポンス（JSON形式）
- エラー時のレスポンス
- HTTPステータスコード

#### 認証・認可

- 認証方法（JWT、OAuth2など）
- 認可の仕組み
- 保護されたエンドポイントの定義

**注意:** 用語は統一する（development-conventions準拠：「API」はWeb APIのみに使用）

### 6. コンポーネント設計

実装単位となるコンポーネントを定義する。
- 実装の見通しを明確にし、開発効率を高める

**フロントエンド:**

- ページコンポーネント
- UIコンポーネント
- 状態管理
- サービス層（API通信）

**バックエンド:**

- コントローラー
- サービス層（ビジネスロジック）
- リポジトリ層（データアクセス）
- ドメインモデル

**各コンポーネントについて定義:**

- 名前と責務
- 依存するコンポーネント
- 提供するインターフェース

**設計原則（coding-conventions準拠）:**

- 単一責任を徹底する
- 関数は100行以内を目安とする
- ネストは最大3段階まで
- ガード節を使用し、早期リターンを徹底する

### 7. セキュリティ設計

非機能要件のセキュリティ要求を実装レベルに落とし込む。
- システムの安全性を確保し、ユーザーのデータを保護する

**設計する項目:**

- 認証の実装方法（JWT、セッション、OAuthなど）
- 認可の実装方法（ロールベース、リソースベース）
- データ保護方法（暗号化、HTTPS）
- 入力検証・サニタイゼーション
- セキュアなエラーハンドリング（情報漏洩防止）

**coding-conventions準拠:**

- パスワードやAPIキーをソースに埋め込まない
- 外部入力は常にバリデーション・サニタイズを行う

### 8. ディレクトリ構造の提案

プロジェクトのファイル構成を提案する。
- 開発効率を高め、チーム全体の生産性を向上させる

**提案内容:**

- 技術スタックに応じた標準的な構造
- フロントエンド・バックエンドのディレクトリ構成
- 設定ファイルの配置
- テストファイルの配置

**注意:** Unixスタイルのパス表記（フォワードスラッシュ）を使用する

### 9. 詳細設計書の作成

収集した情報を詳細設計書としてドキュメント化する。
- 実装フェーズで参照できる形で設計を記録する

**ドキュメント構成:**

1. **プロジェクト概要** - 要件定義書からの概要と目的
2. **技術スタック** - 選定した技術とその理由
3. **システムアーキテクチャ** - レイヤー構成、コンポーネント構成
4. **データベース設計** - テーブル定義、ER図、インデックス、制約
5. **API設計** - エンドポイント定義、リクエスト/レスポンス形式、認証・認可
6. **コンポーネント設計** - フロントエンド/バックエンドのコンポーネント一覧と責務
7. **セキュリティ設計** - 認証・認可の実装方法、データ保護方法
8. **ディレクトリ構造** - プロジェクトのファイル構成
9. **開発規約への準拠** - development-conventionsとcoding-conventionsへの準拠確認

**ドキュメント形式:**

- Markdown形式で作成する
- 保存先はユーザーに確認する

**ドキュメント例については[EXAMPLE.md](EXAMPLE.md)を参照してください。**

## 出力

実装フェーズで参照できる詳細設計書。以下の9項目を含む：

1. プロジェクト概要（目的、ターゲットユーザー、要件の概要）
2. 技術スタック（フロントエンド、バックエンド、データベース、その他ライブラリ）
3. システムアーキテクチャ（レイヤー構成、コンポーネント構成、非機能要件への対応）
4. データベース設計（テーブル定義、ER図、インデックス、制約、命名規則）
5. API設計（エンドポイント定義、リクエスト/レスポンス形式、認証・認可）
6. コンポーネント設計（フロントエンド/バックエンドのコンポーネント一覧と責務）
7. セキュリティ設計（認証・認可の実装方法、データ保護方法）
8. ディレクトリ構造（プロジェクトのファイル構成）
9. 開発規約への準拠（development-conventions、coding-conventions）

**重要:** 詳細設計書には実装コードは含めず、設計情報のみを記載する。
