---
name: implementation
description: 詳細設計書を実際のコードに落とし込むスキル。開発規約に準拠したコード実装、テストコード作成、品質チェック、ドキュメント更新を段階的に実施し、実装フェーズを完遂する。実装、コーディング、開発、プログラミング、テスト作成について言及している場合に使用してください。
---

# Implementation

## 目的

詳細設計書を、開発チームが実装を完遂できるレベルの実装コードとテストコードに落とし込む。

## 責任範囲

- 詳細設計書を読み込み、実装計画を立てる
  - 実装順序を明確にし、効率的な開発を実現する
- コンポーネント/モジュールを規約に準拠して実装する
  - coding-conventionsに従い、保守性の高いコードを作成する
- テストコードを作成する
  - 品質を保証し、リグレッションを防ぐ
- 品質チェックを実施する
  - linter、formatter等で規約遵守を確認する
- 実装に伴うドキュメントを更新する
  - document-conventionsに従い、コードとドキュメントの一貫性を保つ
- Git運用（ブランチ、コミット）を規約に従って実施する
  - branch-commit-conventionsに準拠し、履歴を明確にする

**責任範囲外:**

- 要件の変更や追加
  - requirements-definitionフェーズに戻る必要がある
- 詳細設計の変更
  - detailed-designフェーズに戻る必要がある
- インフラ構築やデプロイ設定の詳細
  - インフラ構築フェーズで行う内容である
- 本番環境へのデプロイ
  - リリースフェーズで行う内容である
- パフォーマンスチューニングの詳細
  - 実装後のパフォーマンス測定に基づいて別途行う

## 参照規約

このスキルは以下の規約を参照して実装を行う：

- **coding-conventions** - C#コーディング規約とベストプラクティス
- **branch-commit-conventions** - ブランチ、コミット、PRの命名規則
- **document-conventions** - ドキュメント作成基準

## ワークフロー

### 1. 詳細設計書の確認

詳細設計書を読み込み、実装すべき内容を把握する。
- 実装の全体像を理解し、漏れなく実装を進める

**読み込みの手順:**

1. 入力ファイルパスが指定されている場合は、そのファイルを読み込む
2. 入力ファイルパスが指定されていない場合は、ユーザーに確認する

**確認する項目:**

- 技術スタック
- システムアーキテクチャ
- コンポーネント設計
- データベース設計（ある場合）
- API設計（ある場合）
- セキュリティ設計（ある場合）
- ディレクトリ構造

**重要:** 不明点や矛盾があれば即座にユーザーに確認する。曖昧なまま進めない。

### 2. 開発環境の確認

プロジェクトの開発環境を確認し、実装の準備を整える。
- 実装に必要なツールと依存関係を確認し、スムーズな開発を可能にする

**確認する項目:**

- **プロジェクト構造**: 既存のプロジェクトファイルとディレクトリ構成
- **依存関係**: 必要なパッケージ・ライブラリのインストール状況
- **開発ツール**: linter、formatter、テストフレームワークの設定
- **ビルド環境**: ビルドが成功するか確認

**確認方法:**

1. プロジェクトルートを確認する
2. パッケージマネージャーのファイル（package.json、requirements.txt、*.csproj等）を確認する
3. 必要に応じて依存関係をインストールする

**注意:** ユーザーに環境の準備状況を確認してから次のステップへ進む。

### 3. 実装計画の作成

実装の優先順位と順序を決定する。
- 効率的な実装順序を決定し、依存関係を考慮した開発を実現する

**計画する項目:**

#### 実装の優先順位

要件定義書の優先順位（P1〜P4）に基づき、実装順序を決定：
- **P1（最優先）**: プロジェクトの核となる機能から実装
- **P2（高優先）**: 初期リリースに必要な機能
- **P3（中優先）**: リリース後の追加も可能な機能
- **P4（低優先）**: 将来的に検討する機能

#### 実装の単位

コンポーネント設計に基づき、実装単位を決定：
1. データモデル/エンティティ
2. データアクセス層（リポジトリ）
3. ビジネスロジック層（サービス）
4. プレゼンテーション層（コントローラー/UI）

#### 依存関係の考慮

- 依存されるコンポーネントから先に実装する
- テスタビリティを考慮し、インターフェースを先に定義する

**質問フォーマットに従い、ユーザーに確認する:**

```markdown
以下の実装計画で進めてよろしいでしょうか？

**フェーズ1: 基盤実装（P1機能）**
- [実装項目1]
- [実装項目2]
- [実装項目3]

**フェーズ2: コア機能実装（P2機能）**
- [実装項目4]
- [実装項目5]

**フェーズ3: 追加機能実装（P3機能）**
- [実装項目6]
- [実装項目7]

調整が必要な項目があれば教えてください。
```

**注意:** ユーザーの承認を待ってから次のステップへ進む。

### 4. コンポーネントの実装

設計に基づきコードを実装する。
- coding-conventionsに準拠した保守性の高いコードを作成する

**実装の原則:**

- **coding-conventionsを遵守する**
  - 命名規則、コーディングスタイル、ベストプラクティスに従う
- **単一責任の原則を適用する**
  - 各クラス・メソッドは1つの責務のみを持つ
- **依存性注入を使用する**
  - テスタビリティと保守性を向上させる
- **エラーハンドリングを適切に実装する**
  - 例外処理を明確にし、エラーメッセージを適切に設定する
- **コメントを適切に記述する**
  - 複雑なロジックには説明を追加する

**実装の手順:**

1. **インターフェース/抽象クラスを定義する**
   - 依存関係を明確にし、テスタビリティを向上させる
2. **データモデル/エンティティを実装する**
   - データ構造を定義し、バリデーションを追加する
3. **データアクセス層を実装する**
   - リポジトリパターンを適用し、データ操作を抽象化する
4. **ビジネスロジック層を実装する**
   - サービスクラスでビジネスルールを実装する
5. **プレゼンテーション層を実装する**
   - コントローラー/UIでユーザーインターフェースを実装する

**各コンポーネント実装後:**

- コードレビューの自己チェックを実施する
- 次のコンポーネントに進む前にユーザーに確認する（必要に応じて）

### 5. テストの実装

実装したコードに対するテストを作成する。
- 品質を保証し、リグレッションを防ぐ

**テストの種類:**

#### ユニットテスト

各コンポーネントの単体テストを実装：
- **テスト対象**: 個別のクラス・メソッド
- **テスト内容**: 正常系、異常系、境界値
- **モック/スタブ**: 依存関係をモック化してテストする

#### 統合テスト

コンポーネント間の連携テストを実装（必要に応じて）：
- **テスト対象**: 複数のコンポーネントの連携
- **テスト内容**: API呼び出し、データベース操作、外部サービス連携

**テスト実装の原則:**

- **AAA（Arrange-Act-Assert）パターンを使用する**
  - テストの構造を明確にする
- **テストケース名を明確にする**
  - 何をテストしているか分かりやすい名前を付ける
- **1テスト1検証を基本とする**
  - テストの失敗原因を特定しやすくする
- **カバレッジを意識する**
  - 重要なロジックは漏れなくテストする

**テスト実装の手順:**

1. テストフレームワークを確認する
2. ユニットテストを実装する
3. テストを実行し、すべて成功することを確認する
4. 必要に応じて統合テストを実装する

### 6. 品質チェックの実施

実装コードの品質を確認する。
- コーディング規約の遵守、潜在的なバグの検出を行う

**実施する項目:**

#### Linter実行

コーディングスタイルと潜在的な問題を検出：
- 未使用変数、未定義変数のチェック
- コーディング規約違反のチェック
- 複雑度の高いコードのチェック

#### Formatter実行

コードフォーマットを統一：
- インデント、改行、スペースの統一
- コードの可読性を向上させる

#### 静的解析実行（可能な場合）

静的解析ツールで潜在的なバグを検出：
- Null参照の可能性
- 型の不整合
- セキュリティ上の問題

#### テスト実行

すべてのテストが成功することを確認：
- ユニットテスト
- 統合テスト

**品質チェックの手順:**

1. Linterを実行し、警告・エラーを修正する
2. Formatterを実行し、コードフォーマットを統一する
3. 静的解析ツールを実行し、問題を修正する（可能な場合）
4. すべてのテストを実行し、成功を確認する

**注意:** すべてのチェックが成功してから次のステップへ進む。

### 7. ドキュメントの更新

実装に伴うドキュメントを更新する。
- document-conventionsに従い、コードとドキュメントの一貫性を保つ

**更新する項目:**

#### README.md

プロジェクトの概要と使い方を更新：
- インストール手順
- 使用方法
- 設定方法
- トラブルシューティング

#### API仕様ドキュメント（ある場合）

実装したAPIの仕様を記載：
- エンドポイント
- リクエスト/レスポンス形式
- エラーコード

#### コード内コメント

複雑なロジックには説明を追加：
- クラス・メソッドのサマリーコメント
- 複雑なアルゴリズムの説明
- TODOコメント（必要に応じて）

#### CHANGELOG.md（ある場合）

実装した機能・変更内容を記録：
- 追加した機能
- 修正したバグ
- 破壊的変更

**ドキュメント更新の原則:**

- **document-conventionsを遵守する**
  - 日本語ドキュメント、Mermaid図の使用
- **具体的に記述する**
  - 曖昧な表現を避け、明確な説明を提供する
- **最新の状態を保つ**
  - コードとドキュメントの不整合を防ぐ

### 8. 実装レポートの作成

実装内容をレポートとしてドキュメント化する。
- 実装内容を記録し、レビューや後続フェーズで参照できるようにする

**レポート構成:**

1. **実装サマリー** - 実装した機能の概要
2. **実装内容** - 実装したコンポーネント、ファイル一覧
3. **テスト結果** - ユニットテスト、統合テストの結果
4. **品質チェック結果** - Linter、Formatter、静的解析の結果
5. **残課題** - 未実装の機能、既知の問題、TODO項目
6. **次のステップ** - 今後の実装予定

**レポート形式:**

- Markdown形式で作成する
- [実装レポートテンプレート](./templates/implementation-report-template.md)を使用する
- 保存先はユーザーに確認する

### 9. Git運用

実装したコードをGitで管理する。
- branch-commit-conventionsに準拠し、履歴を明確にする

**Git運用の原則:**

- **branch-commit-conventionsを遵守する**
  - ブランチ命名規則、コミットメッセージ形式に従う
- **適切な粒度でコミットする**
  - 論理的な単位でコミットを分割する
- **意味のあるコミットメッセージを記述する**
  - 何を変更したか、なぜ変更したかを明確にする

**Git運用の手順:**

1. **ブランチを作成する**（必要に応じて）
   - feature/、fix/等の接頭辞を使用する
2. **変更をステージングする**
   - 関連する変更をまとめてステージングする
3. **コミットする**
   - Conventional Commits形式でコミットメッセージを記述する
4. **プッシュする**（必要に応じて）
   - リモートリポジトリに変更を反映する

**コミットメッセージの例:**

```
feat: ユーザー認証機能を実装

- JWT認証を実装
- ログイン/ログアウトエンドポイントを追加
- 認証ミドルウェアを実装
```

### 10. 完了確認

実装が完了したことを確認する。
- すべての項目が完了し、次フェーズに進める状態であることを確認する

**確認する項目:**

- [ ] すべてのコンポーネントが実装されている
- [ ] すべてのテストが成功している
- [ ] 品質チェックがすべて成功している
- [ ] ドキュメントが更新されている
- [ ] 実装レポートが作成されている
- [ ] Git運用が適切に行われている

**次のステップ:**

- **checking-contradictions**: プロジェクト全体の矛盾検出を実施する
- **コードレビュー**: チームメンバーによるレビューを実施する（チーム開発の場合）

## 出力

実装フェーズの成果物。以下の項目を含む：

1. **実装コード**: 詳細設計に基づくプロダクションコード
2. **テストコード**: ユニットテスト、統合テスト
3. **更新されたドキュメント**: README、API仕様、コメント等
4. **実装レポート**: 実装内容のサマリー、テスト結果、残課題、次のステップ

**重要:** 実装コードはcoding-conventionsに準拠し、テストがすべて成功していること。

## 注意事項

- **規約の遵守**: coding-conventions、branch-commit-conventions、document-conventionsを必ず参照する
- **段階的な進行**: 各ステップの完了後、次のステップに進む前にユーザーに確認する（必要に応じて）
- **品質優先**: テストが失敗している状態で次のステップに進まない
- **ユーザーとの対話**: 要件が不明確な場合は、推測せずにユーザーに質問する
- **設計の尊重**: 詳細設計の意図を理解し、設計に忠実に実装する。設計変更が必要な場合はユーザーに確認する
- **EXAMPLE参照**: [EXAMPLE.md](EXAMPLE.md)
